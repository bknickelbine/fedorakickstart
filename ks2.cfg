# Generated by Anaconda 36.16.5
# Generated by pykickstart v3.36
#version=F36

# The file /tmp/part-include is created below in the %pre section
%include /tmp/part-include

# Use graphical install
graphical

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Run the Setup Agent on first boot
firstboot --enable

# System timezone
timezone America/Phoenix --utc

# Root account is locked and default "kickstart" user is created with password "kickstart"
rootpw --lock
user --groups=wheel --name=kickstart --password=kickstart --gecos="kickstart"

# Set up package mirror/s for install
# Mirror list options
#url --mirrorlist="https://mirrors.fedoraproject.org/mirrorlist?repo=fedora-38&arch=x86_64"
#repo --name=fedora-updates --mirrorlist="https://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f38&arch=x86_64" --cost=0

#CodingFlyBoy repo for faster download speeds
url --url=https://codingflyboy.mm.fcix.net/fedora/linux/development/38/Everything/x86_64/os/ --noverifyssl
repo --name=fedora-updates --baseurl=https://codingflyboy.mm.fcix.net/fedora/linux/updates/38/Everything/x86_64/ --cost=0 --noverifyssl

# Reboot after installation
reboot

# Prepare X to run at boot
xconfig --startxonboot

# Package Selection
%packages
@base-x
@networkmanager-submodules
@fonts
@hardware-support
bluedevil
breeze-gtk
breeze-icon-theme
cagibi
colord-kde
dolphin
glibc-all-langpacks
gnome-keyring-pam
kcm_systemd
kde-gtk-config
kde-partitionmanager
kde-settings-pulseaudio
kde-style-breeze
kdegraphics-thumbnailers
kdeplasma-addons
kdialog
kdnssd
kf5-akonadi-server
kf5-akonadi-server-mysql
kf5-baloo-file
kf5-kipi-plugins
khotkeys
kmenuedit
konsole5
kscreen
kscreenlocker
ksshaskpass
ksysguard
kwebkitpart
kwin
NetworkManager-config-connectivity-fedora
phonon-qt5-backend-gstreamer
pinentry-qt
plasma-breeze
plasma-desktop
plasma-desktop-doc
plasma-nm
plasma-pa
plasma-workspace
plasma-workspace-geolocation
polkit-kde
qt5-qtbase-gui
qt5-qtdeclarative
sddm
sddm-breeze
sddm-kcm
sni-qt
xorg-x11-drv-libinput
%end

# Start of the %pre section with logging into /root/ks-pre.log
%pre --log=/root/ks-pre.log
#----- partitioning logic below--------------
# pick the first drive that is not removable and is over MINSIZE
DIR="/sys/block"
# minimum size of hard drive needed specified in GIGABYTES
MINSIZE=60
MAXSIZE=99999
ROOTDRIVE=""
# /sys/block/*/size is in 512 byte chunks
# The loop first checks NVME then SATA/SAS drives:
for d in $DIR/nvme* $DIR/sd*
do
  DEV=`basename "$d"`
  if [ -d $DIR/$DEV ]; then
    if [[ "`cat $DIR/$DEV/removable`" = "0" ]]
    then
      GB=$((`cat $DIR/$DEV/size`/2**21))
      echo "Disk device $DEV has size $GB GB"
      if [ $GB -gt $MINSIZE -a $GB -lt $MAXSIZE -a -z "$ROOTDRIVE" ]
      then
        ROOTDRIVE=$DEV
        echo "Select ROOTDRIVE=$ROOTDRIVE"
      fi
    fi
  fi
done

if [ -z "$ROOTDRIVE" ]
then
        echo "ERROR: ROOTDRIVE is undefined"
else
        echo "ROOTDRIVE=$ROOTDRIVE"
        cat << EOF > /tmp/part-include
# Generated using Blivet version 3.4.3
ignoredisk --only-use=$ROOTDRIVE
# System bootloader configuration
bootloader --location=mbr --boot-drive=$ROOTDRIVE
autopart
# Partition clearing information
clearpart --drives=$ROOTDRIVE --all --initlabel
EOF
fi
%end